#!/bin/bash

echo 'test 1: handle old # comments'
a.out '
BEGIN {
	# this should be recognized as a comment
	for (i = 0; i < 10; i++) {
	    # print integers 0 through 9
	    print i;
	}
}' > temp1
for i in `seq 0 9`; do echo $i; done > temp2
cmp temp1 temp2 >/dev/null 2>&1 || echo 'Error: test 1 failed: 1..9' 2>&1


echo 'test 2: handle new // comments'
a.out '
BEGIN {
	// this should also be recognized as a comment
	for (i = 0; i < 10; i++) {
	    // print integers 0 through 9
	    print i;
	}
}' > temp1
for i in `seq 0 9`; do echo $i; done > temp2
cmp temp1 temp2 > /dev/null 2>&1 || echo 'Error: test 2 failed: 1..9' 2>&1


echo 'test 3: handle old and new comments, comment chars within comments'
a.out '
BEGIN {
	## this should be recognized as a // comment
	for (i = 0; i < 10; i++) {
	    // print integers #0 through #9
	    print i;
	}
}' > temp1
for i in `seq 0 9`; do echo $i; done > temp2
cmp temp1 temp2 > /dev/null 2>&1 || echo 'Error: test 3 failed: 1..9' 2>&1


echo 'test 4: handle current directory input'
a.out '
	// what is in here does not actually matter
	{ print }
' . 2> temp1
echo -e "a.out: . is a directory\n source line number 4" > temp2
cmp temp1 temp2 > /dev/null 2>&1 || echo 'Error: test 4 failed: input directory should cause fatal error' 2>&1


echo 'test 5: handle other directory input'
a.out '
	// what is in here does not actually matter
	{ print }
' tests/ 2> temp1
echo -e "a.out: tests/ is a directory\n source line number 4" > temp2
cmp temp1 temp2 > /dev/null 2>&1 || echo 'Error: test 5 failed: input directory should cause fatal error' 2>&1


echo 'test 6: handle directory above input'
a.out "
	// what's in here doesn't actually matter
	{ print }
" ../project 2> temp1
echo -e "a.out: ../project is a directory\n source line number 4" > temp2
cmp temp1 temp2 > /dev/null 2>&1 || echo 'Error: test 6 failed: input directory should cause fatal error' 2>&1


echo 'test 7: process normally, input not necessary'
a.out '
       // what is in here does not matter
       BEGIN { print "hello there" }
' ../project > temp1
echo "hello there" > temp2
cmp temp1 temp2 > /dev/null 2>&1 || echo 'Error: test 7 failed: input directory should NOT cause fatal error' 2>&1


echo 'test 8: count from 1 to 10'
a.out '
BEGIN { // count from 1 to 10
	for (i from 1 to 10)
		print i
}' > temp1
for i in `seq 1 10`; do echo $i; done > temp2
cmp temp1 temp2 >/dev/null 2>&1 || echo 'Error: test 8 failed: 1..10' 2>&1


echo 'test 9: count from 1 to 10 by 3'
a.out '
BEGIN {
	for (i from 1 to 10 by 3)
		print i;
}' > temp1
for i in 1 4 7 10; do echo $i; done > temp2
cmp temp1 temp2 >/dev/null 2>&1 || echo 'Error: test 9 failed: 1..10 by 3' 2>&1


echo 'test 10: count from 1 to 10 by 2'
a.out '
BEGIN { i = 5;
        for (i from 1 to 10 by 2)
		print i
}' > temp1
for i in 1 3 5 7 9; do echo $i; done > temp2
cmp temp1 temp2 >/dev/null 2>&1 || echo 'Error: test 10 failed: 1..10 by 2' 2>&1

